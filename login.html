<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NirmalGrama - Secure Login</title>
  <style>
    body {
      font-family: "Poppins", Arial, sans-serif;
      background: linear-gradient(135deg, #74ebd5, #9face6);
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background 0.5s ease;
    }
    body.signup-mode {
      background: linear-gradient(135deg, #a8e063, #56ab2f);
    }
    .container {
      background: white;
      padding: 35px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      width: 100%;
      margin-top: 15px;
      padding: 10px;
      border: none;
      background: #2980b9;
      color: white;
      font-size: 15px;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover { background: #1e6394; }
    #toggleMode { background: #27ae60; margin-top: 8px; }
    #voiceLoginBtn { background: #6c5ce7; }
    #officerCodeBox { display: none; }
    #msg { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h2 id="title">Login</h2>

    <label for="lang" id="langLabel">Choose Language:</label>
    <select id="lang" onchange="setLanguage()">
      <option value="en">English</option>
      <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
      <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
    </select>

    <form id="loginForm">
      <label for="role">Select Role:</label>
      <select id="role" onchange="toggleOfficerCode()">
        <option value="villager">üë©‚Äçüåæ Villager</option>
        <option value="officer">üè¢ Panchayat Officer</option>
      </select>

      <div id="officerCodeBox">
        <label for="officerCode">Officer Access Code:</label>
        <input type="password" id="officerCode" placeholder="Enter secret code (NG12345)" />
      </div>

      <label for="username" id="usernameLabel">Username</label>
      <input type="text" id="username" required />

      <label for="password" id="passwordLabel">Password</label>
      <input type="password" id="password" required />

      <button type="submit" id="submitBtn">Login</button>
      <button type="button" id="toggleMode">Switch to Signup</button>
      <button type="button" id="voiceLoginBtn">üé§ Voice Login</button>
      <p id="msg"></p>
    </form>
  </div>

  <script>
    const translations = {
      en: {
        loginTitle: "Login",
        signupTitle: "Signup",
        usernameLabel: "Username",
        passwordLabel: "Password",
        loginBtn: "Login",
        signupBtn: "Signup",
        toggleToSignup: "Switch to Signup",
        toggleToLogin: "Switch to Login",
        langLabel: "Choose Language:",
        roleLabel: "Select Role:",
        successLogin: "‚úÖ Login successful!",
        successSignup: "‚úÖ Signup successful!",
        invalidOfficerCode: "‚ùå Invalid Officer Code!",
        fillAll: "‚ö†Ô∏è Please fill all fields.",
        error: "‚ùå Invalid credentials!",
      },
      te: {
        loginTitle: "‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç",
        signupTitle: "‡∞®‡∞Æ‡±ã‡∞¶‡±Å",
        usernameLabel: "‡∞µ‡∞ø‡∞®‡∞ø‡∞Ø‡±ã‡∞ó‡∞¶‡∞æ‡∞∞‡±Å ‡∞™‡±á‡∞∞‡±Å",
        passwordLabel: "‡∞™‡∞æ‡∞∏‡±ç‚Äå‡∞µ‡∞∞‡±ç‡∞°‡±ç",
        loginBtn: "‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç",
        signupBtn: "‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
        toggleToSignup: "‡∞®‡∞Æ‡±ã‡∞¶‡±Å‡∞ï‡±Å ‡∞Æ‡∞æ‡∞∞‡∞Ç‡∞°‡∞ø",
        toggleToLogin: "‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç‚Äå‡∞ï‡±Å ‡∞Æ‡∞æ‡∞∞‡∞Ç‡∞°‡∞ø",
        langLabel: "‡∞≠‡∞æ‡∞∑‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø:",
        roleLabel: "‡∞™‡∞æ‡∞§‡±ç‡∞∞‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø:",
        successLogin: "‚úÖ ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Æ‡±à‡∞Ç‡∞¶‡∞ø!",
        successSignup: "‚úÖ ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Æ‡±à‡∞Ç‡∞¶‡∞ø!",
        invalidOfficerCode: "‚ùå ‡∞§‡∞™‡±ç‡∞™‡±Å ‡∞Ö‡∞ß‡∞ø‡∞ï‡∞æ‡∞∞ ‡∞ï‡±ã‡∞°‡±ç!",
        fillAll: "‚ö†Ô∏è ‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞™‡±Ç‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
        error: "‚ùå ‡∞§‡∞™‡±ç‡∞™‡±Å ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å!",
      },
      hi: {
        loginTitle: "‡§≤‡•â‡§ó‡§ø‡§®",
        signupTitle: "‡§∏‡§æ‡§á‡§® ‡§Ö‡§™",
        usernameLabel: "‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ",
        passwordLabel: "‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°",
        loginBtn: "‡§≤‡•â‡§ó‡§ø‡§®",
        signupBtn: "‡§∏‡§æ‡§á‡§® ‡§Ö‡§™ ‡§ï‡§∞‡•á‡§Ç",
        toggleToSignup: "‡§∏‡§æ‡§á‡§® ‡§Ö‡§™ ‡§™‡§∞ ‡§∏‡•ç‡§µ‡§ø‡§ö ‡§ï‡§∞‡•á‡§Ç",
        toggleToLogin: "‡§≤‡•â‡§ó‡§ø‡§® ‡§™‡§∞ ‡§∏‡•ç‡§µ‡§ø‡§ö ‡§ï‡§∞‡•á‡§Ç",
        langLabel: "‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç:",
        roleLabel: "‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç:",
        successLogin: "‚úÖ ‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡§´‡§≤!",
        successSignup: "‚úÖ ‡§∏‡§æ‡§á‡§® ‡§Ö‡§™ ‡§∏‡§´‡§≤!",
        invalidOfficerCode: "‚ùå ‡§ó‡§≤‡§§ ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•ã‡§°!",
        fillAll: "‚ö†Ô∏è ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç‡•§",
        error: "‚ùå ‡§ó‡§≤‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£!",
      },
    };

    let isSignup = false;

    function setLanguage() {
      const lang = document.getElementById("lang").value;
      const t = translations[lang];
      document.getElementById("title").textContent = isSignup ? t.signupTitle : t.loginTitle;
      document.getElementById("usernameLabel").textContent = t.usernameLabel;
      document.getElementById("passwordLabel").textContent = t.passwordLabel;
      document.getElementById("submitBtn").textContent = isSignup ? t.signupBtn : t.loginBtn;
      document.getElementById("toggleMode").textContent = isSignup ? t.toggleToLogin : t.toggleToSignup;
      document.getElementById("langLabel").textContent = t.langLabel;
      document.querySelector("label[for='role']").textContent = t.roleLabel;
      localStorage.setItem("lang", lang);
    }

    function toggleOfficerCode() {
      const role = document.getElementById("role").value;
      document.getElementById("officerCodeBox").style.display = role === "officer" ? "block" : "none";
    }

    function toggleMode() {
      isSignup = !isSignup;
      document.body.classList.toggle("signup-mode", isSignup);
      setLanguage();
      document.getElementById("msg").textContent = "";
    }

    async function handleAuth(e) {
      e.preventDefault();
      const lang = document.getElementById("lang").value;
      const t = translations[lang];
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const role = document.getElementById("role").value;
      const officerCode = document.getElementById("officerCode").value.trim();
      const msg = document.getElementById("msg");

      if (!username || !password) {
        msg.textContent = t.fillAll;
        msg.style.color = "red";
        return;
      }

      // ‚úÖ Officer code validation
      if (role === "officer" && officerCode !== "NG12345") {
        msg.textContent = t.invalidOfficerCode;
        msg.style.color = "red";
        return;
      }

      const endpoint = isSignup ? "/signup" : "/login";

      try {
        const res = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password, role }),
        });

        const data = await res.json();
        if (res.ok) {
          msg.style.color = "green";
          msg.textContent = isSignup ? t.successSignup : t.successLogin;
          localStorage.setItem("user", username);
          localStorage.setItem("role", role);
          localStorage.removeItem("voiceUser");
          localStorage.removeItem("loginMethod");
          setTimeout(() => {
            if (role === "villager") window.location.href = "villager.html";
            else window.location.href = "admin.html";
          }, 1000);
        } else {
          msg.style.color = "red";
          msg.textContent = data.message || t.error;
        }
      } catch {
        msg.style.color = "red";
        msg.textContent = "‚ö†Ô∏è Server not responding.";
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const savedLang = localStorage.getItem("lang") || "en";
      document.getElementById("lang").value = savedLang;
      setLanguage();
      toggleOfficerCode();

      document.getElementById("loginForm").addEventListener("submit", handleAuth);
      document.getElementById("toggleMode").addEventListener("click", toggleMode);

      // üé§ Voice login redirect
      document.getElementById("voiceLoginBtn").addEventListener("click", () => {
        window.location.href = "voice-login.html";
      });
    });
  </script>
</body>
</html>
